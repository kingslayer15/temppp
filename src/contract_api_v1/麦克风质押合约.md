# 麦克风质押合约(FCMStake)

## 简介
提供麦克风质押功能, 测试环境 1分钟等于一天

## 合约地址
```
正式(弃用):
    proxyAdmin: 0xc58e22E4F5E591eAAdd9BcC08f88459434f30588
    proxy: 0xCf891519248B764b4f576b40DbB6523283BCFBad

正式V2:
    proxyAdmin: 0xc58e22E4F5E591eAAdd9BcC08f88459434f30588
    proxy:0x27ec49F60CF01e12Ec08b63e92223cb846b4E32F

测试Goerli:
    proxyAdmin: 0x3835Dd2349597Ec89D1aE2Cf4aab52a2Da29Da57 
    proxy地址: 0x5a335e4a5E533f58F97C4D471563e21650bB97ff //前端用这个
```

## ABI
```
[{"inputs":[{"internalType":"uint8","name":"_pool","type":"uint8"},{"internalType":"uint256[]","name":"_ids","type":"uint256[]"}],"name":"deposit","outputs":[],"stateMutability":"nonpayable","type":"function"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"account","type":"address"},{"indexed":false,"internalType":"uint8","name":"pool","type":"uint8"},{"indexed":false,"internalType":"uint256[]","name":"_ids","type":"uint256[]"}],"name":"Deposit","type":"event"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"grantRole","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"initialize","outputs":[],"stateMutability":"nonpayable","type":"function"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint8","name":"version","type":"uint8"}],"name":"Initialized","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"time","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"ethPrice","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"outputPerSecond","type":"uint256"}],"name":"PushEthPrice","type":"event"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"renounceRole","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"revokeRole","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_amount","type":"uint256"}],"name":"reward","outputs":[],"stateMutability":"nonpayable","type":"function"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"account","type":"address"},{"indexed":false,"internalType":"uint256","name":"receiveAmount","type":"uint256"}],"name":"Reward","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"role","type":"bytes32"},{"indexed":true,"internalType":"bytes32","name":"previousAdminRole","type":"bytes32"},{"indexed":true,"internalType":"bytes32","name":"newAdminRole","type":"bytes32"}],"name":"RoleAdminChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"role","type":"bytes32"},{"indexed":true,"internalType":"address","name":"account","type":"address"},{"indexed":true,"internalType":"address","name":"sender","type":"address"}],"name":"RoleGranted","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"role","type":"bytes32"},{"indexed":true,"internalType":"address","name":"account","type":"address"},{"indexed":true,"internalType":"address","name":"sender","type":"address"}],"name":"RoleRevoked","type":"event"},{"inputs":[{"internalType":"address","name":"_newFcc","type":"address"}],"name":"setFcc","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_newFccPool","type":"address"}],"name":"setFccPool","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_newFcm","type":"address"}],"name":"setFcm","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_newFcmValue","type":"uint256"}],"name":"setFcmValue","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_newFirstRewardRate","type":"uint256"}],"name":"setFirstRewardRate","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint8","name":"_pool","type":"uint8"},{"internalType":"uint256","name":"_depth","type":"uint256"},{"internalType":"uint256","name":"_rate","type":"uint256"}],"name":"setPoolConfig","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_newRewardPeriod","type":"uint256"}],"name":"setRewardPeriod","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_time","type":"uint256"}],"name":"setUnlockTime","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256[]","name":"_ids","type":"uint256[]"}],"name":"withdraw","outputs":[],"stateMutability":"nonpayable","type":"function"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"account","type":"address"},{"indexed":false,"internalType":"uint256[]","name":"_ids","type":"uint256[]"}],"name":"Withdraw","type":"event"},{"inputs":[],"name":"ADMIN_ROLE","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"allPoolInfo","outputs":[{"components":[{"internalType":"bool","name":"opened","type":"bool"},{"internalType":"uint256","name":"depth","type":"uint256"},{"internalType":"uint256","name":"fill","type":"uint256"},{"internalType":"uint256","name":"rate","type":"uint256"},{"internalType":"string","name":"name","type":"string"}],"internalType":"struct StakePoolTest.Pool[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"blockTime","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_account","type":"address"}],"name":"canReward","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"DEFAULT_ADMIN_ROLE","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"fcc","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"fccPool","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"fcm","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"fcmValue","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"firstRewardRate","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_account","type":"address"}],"name":"getAllAward","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_account","type":"address"}],"name":"getItems","outputs":[{"components":[{"internalType":"uint256","name":"balances","type":"uint256"},{"internalType":"uint256[]","name":"ids","type":"uint256[]"},{"internalType":"uint256","name":"updateTime","type":"uint256"}],"internalType":"struct StakePoolTest.Item[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"}],"name":"getRoleAdmin","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"uint256","name":"index","type":"uint256"}],"name":"getRoleMember","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"}],"name":"getRoleMemberCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"hasRole","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"isStaking","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256[]","name":"_ids","type":"uint256[]"}],"name":"isStakingBatch","outputs":[{"internalType":"bool[]","name":"","type":"bool[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"MATCH_MOD","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"OPERATOR_ROLE","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"PERIOD_SECOND","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"receivedAmount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"rewardPeriod","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"unlockTime","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}]
```

## 结构体
```JavaScript
    struct Pool{
        bool opened; //是否开启
        uint256 depth; //池子容量
        uint256 fill; //现有数量
        uint256 rate; //领取比例 ‱
        string name; //池子名称
    }

    struct Item{
        uint256 balances; //用于内部计算,前端不用管
        uint256[] ids; //质押的tokenId
        uint256 updateTime; //用于内部计算,前端不用管
    }
```

## 交易接口

#### 1.质押
```JavaScript
    function deposit(uint256 _pool, uint256[] calldata _ids) external;
    
    入参:
        _pool: 池子, 目前为 0=钻石池，1=黄金池，2=白银池，3=青铜池
        _ids: 质押的tokenId, 数组
```

#### 2.解除质押
```JavaScript
    function withdraw(uint256[] calldata _ids) external;

    入参:
        _ids: 需要解除质押的tokenId, 数组
```

#### 3.领取奖励
```JavaScript
    function reward(uint256 _amount) external;

    入参:
        _amount: 想要领取的数量
```

#### 4.设置解锁时间
```JavaScript
    function setUnlockTime(uint256 _time) external onlyRole(OPERATOR_ROLE);
    说明: 需要运营管理员OPERATOR_ROLE权限

    入参:
        _time: 解锁时间
```

#### 5.设置fcc地址
```JavaScript
    function setFcc(address _newFcc) external onlyRole(OPERATOR_ROLE);
    说明: 需要运营管理员OPERATOR_ROLE权限

    入参:
        _newFcc: 新的fcc地址
```

#### 6.设置fcm地址
```JavaScript
    function setFcm(address _newFcm) external onlyRole(OPERATOR_ROLE);
    说明: 需要运营管理员OPERATOR_ROLE权限

    入参:
        _newFcm: 新的fcm地址
```

#### 7.设置fcc支出账户地址
```JavaScript
    function setFccPool(address _newFccPool) external onlyRole(OPERATOR_ROLE);
    说明: 需要运营管理员OPERATOR_ROLE权限

    入参:
        _newFccPool: 新的fcc支出账户地址
```

#### 8.设置fcm价值
```JavaScript
    function setFcmValue(uint256 _newFcmValue) external onlyRole(OPERATOR_ROLE);
    说明: 需要运营管理员OPERATOR_ROLE权限

    入参:
        _newFcmValue: 新的fcm价值, 需要 * 1e18
```

#### 9.设置首日释放比例
```JavaScript
    function setFirstRewardRate(uint256 _newFirstRewardRate) external onlyRole(OPERATOR_ROLE);
    说明: 需要运营管理员OPERATOR_ROLE权限

    入参:
        _newFirstRewardRate: 新的首日释放比例 %
```

#### 10.设置线性解锁周期
```JavaScript
    function setRewardPeriod(uint256 _newRewardPeriod) external onlyRole(OPERATOR_ROLE);
    说明: 需要运营管理员OPERATOR_ROLE权限

    入参:
        _newRewardPeriod: 新的线性解锁周期, 一个周期等于一天, 测试合约是一个周期等于一分钟
```

#### 11.设置池子参数
```JavaScript
    function setPoolConfig(uint8 _pool, uint256 _depth, uint256 _rate) external onlyRole(OPERATOR_ROLE);
    说明: 需要运营管理员OPERATOR_ROLE权限
    注意: 当池子已有质押时，不建议使用，会使只有没调用过 _updateItme() 函数结算的收益按新的参数计算，已结算的收益不会改变

    入参:
        _pool: 需要变更的池子编号, 目前为 0=钻石池，1=黄金池，2=白银池，3=青铜池
        _depth: 池子容量
        _rate: 奖励比例
```

## 查询接口

#### 1.查询池子详情
```JavaScript
    function poolInfo(uint256 _pool) public view retruns(Pool memory);

    入参:
        _pool: 要查询的池子编号
    返回:
        1. 池子结构体, 见结构体说明
```

#### 2.查询nft是否在质押中
```JavaScript
    function isStaking(uint256 _id) public view returns(bool);

    入参:
        _id: 麦克风tokenId
    返回:
        1. bool: 是否质押中
```

#### 3.批量查询nft是否在质押中
```JavaScript
    function isStakingBatch(uint256[] calldata _ids) external view returns(bool[] memory);

    入参:
        _ids: 麦克风tokenId, 数组
    返回:
        1. bool[]: 是否质押中, 数组
```

#### 4.查询所有池子信息
```JavaScript
    function allPoolInfo() external view returns(Pool[] memory);

    返回
        1. Pool[]: 池子信息结构体数组
```

#### 5.查询用户质押详情
```JavaScript
    function getItems(address _account) external view returns(Item[] memory)

    入参
        _account: 用户地址
    返回
        1. Item[]: 用户账单结构体数组, 下标对应池子编号, 见结构体说明
```

#### 6.查询用户可领取收益
```JavaScript
    function canReward(address _account) external view returns(uint256)

    入参
        _account: 用户地址
    返回
        1. uint256: 用户现在可领取的收益, blockTime < unloockTime 时, 直接返回0
```

#### 7.查询用户所有池子的累计收益
```JavaScript
    function getAllAward(address _account) external view returns(uint256[] memory)

    入参
        _account: 用户地址
    返回
        1. uint256[]: 用户收益数组, 下标对应池子编号
```

#### 7.查询解锁时间
```JavaScript
    function unlockTime() external view returns(uint256)

    返回
        1. uint256: 可解除质押,领取奖励的时间
```



## 事件

#### 1.质押事件
```JavaScript
    event Deposit(address indexed account, uint8 pool, uint256[] _ids);

    account: 用户地址, topic1
    pool: 池子编号
    ids: 质押的麦克风tokenId
```

#### 2.解除质押事件
```JavaScript
    event Withdraw(address indexed account, uint256[] _ids);

    account: 用户地址, topic1
    ids: 取出的麦克风tokenId
```

#### 3.领取奖励事件
```JavaScript
    event Reward(address indexed account,uint256 receiveAmount);

    account: 用户地址, topic1
    poolNo: 领取数量
```
