# 功能合约(BenefitCard)

## 合约简介
提供购买盲盒,设置盲盒参数,购买vip卡功能

## 合约地址
```
正式:
    0x451874e32aDeF74AEBE26a481071F781A727E2c9
测试Goerli:
    0x7BDe916c7Ee94abF28A2167fF76fe553d99d4076

```

## ABI
```
[{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"airdroper","type":"address"},{"indexed":false,"internalType":"address[]","name":"tos","type":"address[]"},{"indexed":false,"internalType":"uint256[]","name":"numberOfTokens","type":"uint256[]"}],"name":"AirdropFcm","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":true,"internalType":"uint256","name":"count","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"round","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"BuyEvent","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"count","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"BuyVipEvent","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint8","name":"version","type":"uint8"}],"name":"Initialized","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"role","type":"bytes32"},{"indexed":true,"internalType":"bytes32","name":"previousAdminRole","type":"bytes32"},{"indexed":true,"internalType":"bytes32","name":"newAdminRole","type":"bytes32"}],"name":"RoleAdminChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"role","type":"bytes32"},{"indexed":true,"internalType":"address","name":"account","type":"address"},{"indexed":true,"internalType":"address","name":"sender","type":"address"}],"name":"RoleGranted","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"role","type":"bytes32"},{"indexed":true,"internalType":"address","name":"account","type":"address"},{"indexed":true,"internalType":"address","name":"sender","type":"address"}],"name":"RoleRevoked","type":"event"},{"inputs":[],"name":"ADMIN_ROLE","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"DEFAULT_ADMIN_ROLE","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"OPERATOR_ROLE","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address[]","name":"tos","type":"address[]"},{"internalType":"uint256[]","name":"numberOfTokens","type":"uint256[]"}],"name":"airdropFcm","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"currentRound","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"erc1155Card","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"erc1155Vip","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"freeCity","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"},{"internalType":"uint256","name":"numberOfTokens","type":"uint256"}],"name":"getMintPrice","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getPayee","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_round","type":"uint256"}],"name":"getPriceRange","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"},{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"}],"name":"getRoleAdmin","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"uint256","name":"index","type":"uint256"}],"name":"getRoleMember","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"}],"name":"getRoleMemberCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_round","type":"uint256"}],"name":"getRoundInfo","outputs":[{"internalType":"uint256","name":"total","type":"uint256"},{"internalType":"uint256","name":"alreadyTotal","type":"uint256"},{"internalType":"uint256","name":"price","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"uint256","name":"numberOfTokens","type":"uint256"}],"name":"getVipPrice","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"grantRole","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"hasRole","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_owner","type":"address"},{"internalType":"address","name":"_payee_","type":"address"},{"internalType":"uint256","name":"_mintAmount","type":"uint256"},{"internalType":"address","name":"_freeCity","type":"address"},{"internalType":"address","name":"_erc1155Card","type":"address"},{"internalType":"address","name":"_erc1155Vip","type":"address"}],"name":"initialize","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"mintAmount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"numberOfTokens","type":"uint256"}],"name":"preSale","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"renounceRole","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"revokeRole","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"uint256","name":"numberOfTokens","type":"uint256"}],"name":"saleVip","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"bool","name":"_canSell","type":"bool"}],"name":"setCanSell","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_round","type":"uint256"}],"name":"setCurrentRound","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_erc1155Card","type":"address"}],"name":"setErc1155CardContract","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_erc1155Vip","type":"address"}],"name":"setErc1155VipContract","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_freeCity","type":"address"}],"name":"setFreeCityContract","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_mintAmount","type":"uint256"}],"name":"setMintAmount","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_newPayee","type":"address"}],"name":"setPayee","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"roleId","type":"bytes32"},{"internalType":"bytes32","name":"adminRoleId","type":"bytes32"}],"name":"setRoleAdmin","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_round","type":"uint256"},{"internalType":"uint256","name":"_totalSupply","type":"uint256"},{"internalType":"string","name":"baseUri","type":"string"},{"internalType":"uint256[]","name":"ranges","type":"uint256[]"},{"internalType":"uint256[]","name":"prices","type":"uint256[]"}],"name":"setRoundInfo","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_round","type":"uint256"},{"internalType":"uint256","name":"_totalSupply","type":"uint256"},{"internalType":"uint256","name":"_alreadNonce","type":"uint256"},{"internalType":"string","name":"baseUri","type":"string"},{"internalType":"uint256[]","name":"ranges","type":"uint256[]"},{"internalType":"uint256[]","name":"prices","type":"uint256[]"}],"name":"updateRoundInfo","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"userBuyTotal","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"vipTotal","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"}],"name":"withDraw","outputs":[],"stateMutability":"nonpayable","type":"function"}]
```

## 交易接口
#### 1.购买盲盒
```JavaScript
    function preSale(uint256 numberOfTokens) external payable;
    说明: 'payaqble'关键字代表可以发送eth, 此方法需要发送相应数量的eth

    入参:
        numberOfToken: 购买数量

```
#### 2.购买vip卡
```JavaScript
    function saleVip(uint256 tokenId, uint256 numberOfTokens) external payable;
    说明: 'payaqble'关键字代表可以发送eth, 此方法需要发送相应数量的eth
          前500张vip卡需要购买5个盲盒才能购买, 后面的vip卡需要购买10个盲盒才能购买

    入参:
        tokenId: vip卡类型, 现在用的是 2 
        numberOfToken: 数量
```

#### 3.提取合约eth余额
```JavaScript
    function withDraw(address to) public onlyRole(ADMIN_ROLE);
    说明: 需要管理员ADMIN_ROLE权限

    入参: 
        to: 收款地址
```

#### 4.变更购买批次
```JavaScript
    function setCurrentRound(uint256 _round) public onlyRole(OPERATOR_ROLE);
    说明: 需要运营管理员OPERATOR_ROLE权限

    入参:
        _round: 新批次
```

#### 5.管理员空投
```JavaScript
    function airdropFcm(address[] memory tos, uint256[] memory numberOfTokens) external onlyRole(OPERATOR_ROLE);
    说明: 需要管理员OPERATOR_ROLE权限

    入参:
        tos: 空投目标地址, 数组
        numberOfTokens: 空投数量, 数组
```

#### 6.设置新的批次
```JavaScript
    function setRoundInfo(uint256 _round, uint256 _totalSupply, string calldata baseUri, uint256[] memory ranges, uint256[] memory prices) public onlyRole(OPERATOR_ROLE);
    说明: 需要管理员OPERATOR_ROLE权限

    入参:
        _round: 批次编号, 需要大于当前批次
        _totalSupply: 批次发行量
        baseUri: 批次token的baseUri
        ranges: tokenId数组, 长度与 _totalSupply 相同, 下标与 prices 对应
        prices: 价格数组, 长度与 _totalSupply 相同, 下标与 ranges 对应
```



## 查询接口
#### 1.预估盲盒的价格
```JavaScript
    function getMintPrice(address account, uint256 numberOfTokens) public view returns (uint256);

    入参:
        account: 购买者地址
        numberOfTokens: 想要购买的数量
    返回:
        1.总价
```

#### 2.预估vip卡的价格
```JavaScript
    function getVipPrice(uint256 tokenId, uint256 numberOfTokens) public view returns (uint256);

    入参:
        tokenId: vip卡类型, 现在是 2
        numberOfToken: 想要购买的数量
    返回:
        1.总价
```

#### 3.查询批次盲盒信息
```JavaScript
    function getRoundInfo(uint256 _round) public view returns (uint256 total, uint256 alreadyTotal, uint256 price);

    入参:
        _round: 批次id
    返回:
        1. total: 批次最大发行量
        2. alreadyTotal: 已铸造量
        3. price: 单价

```

#### 4.查询当前批次
```JavaScript
    function currentRound() public view returns(uint256);

    返回:
        1. 批次id
```

#### 5.查询用户购买盲盒总数
```JavaScript
    function userBuyTotal(address user) public view returns(uint256);

    入参:
        user: 要查询的地址
    返回:
        1. 购买的盲盒总数
```

#### 6.查询用户购买vip已经用掉的盲盒额度
```JavaScript
    function vipTotal(address user, uint256 tokenId) public view returns(uint256);

    入参:
        user: 要查询的地址
        tokenId: vip类型, 2
    返回:
        1. 已经用掉的盲盒额度
```



## 事件
#### 1.购买盲盒
```JavaScript
    event BuyEvent(address indexed user, uint256 indexed count, uint256 round, uint256 value);

    user: 购买者地址, topic1
    count: 购买数量, topic2
    round: 批次
    value: 消费的eth数量
```

#### 2.购买vip卡
```JavaScript
    event BuyVipEvent(address indexed user, uint256 indexed tokenId, uint256 count, uint256 value);

    user: 购买者地址, topic1
    tokenId: VIP类型, topic2
    count: 购买数量
    value: 消费的eth数量
```

#### 3.管理员空投事件
```JavaScript
    event AirdropFcm(address indexed airdroper, address[] tos, uint256[] numberOfTokens);

    airdroper: 进行空投的管理员地址
    tos: 空投目标地址, 数组
    numberOfTokens: 空投数量, 数组
```
