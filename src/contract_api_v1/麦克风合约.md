# 麦克风合约(CardERC155)

## 简介
麦克风nft, 此次仅展示非erc721标准的接口, 其他请参考 ./标准接口/erc721标准接口

## 合约地址
```
正式:
    proxyAdmin: 0xc58e22E4F5E591eAAdd9BcC08f88459434f30588
    proxy: 0xae2a446987443f8b3BEce157F9FdB2AD549B4D8C
测试Goerli:
    0x581B2C66362677EB8765fB103230351A1E437d08
```

## ABI
```
[{"inputs":[],"name":"NotAllowApproval","type":"error"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"approved","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":false,"internalType":"bool","name":"approved","type":"bool"}],"name":"ApprovalForAll","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"","type":"address"},{"indexed":true,"internalType":"uint256","name":"","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Deposit","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"","type":"address"},{"indexed":true,"internalType":"address","name":"","type":"address"},{"indexed":false,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Exchange","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint8","name":"version","type":"uint8"}],"name":"Initialized","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"role","type":"bytes32"},{"indexed":true,"internalType":"bytes32","name":"previousAdminRole","type":"bytes32"},{"indexed":true,"internalType":"bytes32","name":"newAdminRole","type":"bytes32"}],"name":"RoleAdminChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"role","type":"bytes32"},{"indexed":true,"internalType":"address","name":"account","type":"address"},{"indexed":true,"internalType":"address","name":"sender","type":"address"}],"name":"RoleGranted","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"role","type":"bytes32"},{"indexed":true,"internalType":"address","name":"account","type":"address"},{"indexed":true,"internalType":"address","name":"sender","type":"address"}],"name":"RoleRevoked","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"parent","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"mother","type":"uint256"}],"name":"Synthesis","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"","type":"address"},{"indexed":false,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Withdraw","type":"event"},{"inputs":[],"name":"ADMIN_ROLE","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"DEFAULT_ADMIN_ROLE","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"MAXMINTLIMIT","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"OPERATOR_ROLE","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"approve","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"burn","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"canExchange","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"uint256","name":"userId","type":"uint256"}],"name":"deposit","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint128","name":"life","type":"uint128"},{"internalType":"uint128","name":"grade","type":"uint128"}],"name":"exchange","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"exchangeWhiteMap","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getApproved","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"}],"name":"getRoleAdmin","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"uint256","name":"index","type":"uint256"}],"name":"getRoleMember","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"}],"name":"getRoleMemberCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getVoiceInfo","outputs":[{"components":[{"internalType":"uint128","name":"life","type":"uint128"},{"internalType":"uint128","name":"grade","type":"uint128"},{"internalType":"uint256","name":"parent","type":"uint256"},{"internalType":"uint256","name":"mother","type":"uint256"},{"internalType":"string","name":"tokenURI","type":"string"}],"internalType":"struct FreeCityGameNFT.Voice","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"grantRole","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"hasRole","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"string","name":"name","type":"string"},{"internalType":"string","name":"symbol","type":"string"}],"name":"initialize","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"operator","type":"address"}],"name":"isApprovedForAll","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"isStaking","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_tokenId","type":"uint256"}],"name":"metaMutData","outputs":[{"internalType":"uint128","name":"life","type":"uint128"},{"internalType":"uint128","name":"grade","type":"uint128"},{"internalType":"bool","name":"status","type":"bool"},{"internalType":"string","name":"uri","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"string","name":"_tokenURI","type":"string"}],"name":"mint","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256[]","name":"metaDataIds","type":"uint256[]"},{"internalType":"string","name":"baseUri","type":"string"}],"name":"multiPreMint","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"ownerOf","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"metaDataId","type":"uint256"},{"internalType":"string","name":"baseUri","type":"string"}],"name":"preMint","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"renounceRole","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"resetTokenRoyalty","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"revokeRole","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_tokenId","type":"uint256"},{"internalType":"uint256","name":"_salePrice","type":"uint256"}],"name":"royaltyInfo","outputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"_tokenId","type":"uint256"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"_tokenId","type":"uint256"},{"internalType":"bytes","name":"data","type":"bytes"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"bool","name":"approved","type":"bool"}],"name":"setApprovalForAll","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bool","name":"_canExchange","type":"bool"}],"name":"setCanExchange","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"receiver","type":"address"},{"internalType":"uint96","name":"feeNumerator","type":"uint96"}],"name":"setDefaultRoyalty","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_to","type":"address"},{"internalType":"bool","name":"_canExchange","type":"bool"}],"name":"setExchangeWhiteMap","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"roleId","type":"bytes32"},{"internalType":"bytes32","name":"adminRoleId","type":"bytes32"}],"name":"setRoleAdmin","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"address","name":"receiver","type":"address"},{"internalType":"uint96","name":"feeNumerator","type":"uint96"}],"name":"setTokenRoyalty","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"parent","type":"uint256"},{"internalType":"uint256","name":"mother","type":"uint256"},{"internalType":"address","name":"to","type":"address"},{"internalType":"string","name":"_tokenURI","type":"string"}],"name":"synthesis","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"index","type":"uint256"}],"name":"tokenByIndex","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"uint256","name":"index","type":"uint256"}],"name":"tokenOfOwnerByIndex","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"tokenURI","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"tokensOfOwner","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"_tokenId","type":"uint256"}],"name":"transferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"string","name":"_tokenUrl","type":"string"}],"name":"updateTokenUri","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"components":[{"internalType":"uint128","name":"life","type":"uint128"},{"internalType":"uint128","name":"grade","type":"uint128"},{"internalType":"uint256","name":"parent","type":"uint256"},{"internalType":"uint256","name":"mother","type":"uint256"},{"internalType":"string","name":"tokenURI","type":"string"}],"internalType":"struct FreeCityGameNFT.Voice","name":"voice","type":"tuple"}],"name":"updateVoiceInfo","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"uint128","name":"life","type":"uint128"},{"internalType":"uint128","name":"grade","type":"uint128"}],"name":"withdraw","outputs":[],"stateMutability":"nonpayable","type":"function"}]
```

## 交易接口

#### 1.铸造
```JavaScript
    function preMint(address to, uint256 metaDataId, string calldata baseUri) external override onlyRole(OPERATOR_ROLE);
    说明: 需要运营管理员OPERATOR_ROLE权限

    入参:
        to: 接收地址
        metaDataId: 元数据文件id
        baseUri: 元数据基础uri
```

#### 2.批量铸造
```JavaScript
    function multiPreMint(address to, uint256[] calldata metaDataIds, string calldata baseUri) external override onlyRole(OPERATOR_ROLE);
    说明: 需要运营管理员OPERATOR_ROLE权限

    入参:
        to: 接收地址
        metaDataId: 元数据文件id, 数组
        baseUri: 元数据基础uri
```

#### 3.铸造(不指定元数据Id)
```JavaScript
     function mint(address to, string calldata _tokenURI) external onlyRole(OPERATOR_ROLE);
     说明: 需要运营管理员OPERATOR_ROLE权限

     入参:
        to: 接收地址
        _tokenURI: 元数据uri
```

#### 4.更新token元数据uri
```JavaScript
    function updateTokenUri(uint256 tokenId, string memory _tokenUrl) external onlyRole(OPERATOR_ROLE);
    说明: 需要运营管理员OPERATOR_ROLE权限

    入参:
        tokenId: 需要更新的tokenId
        _tokenUrl: 新的元数据uri
```

#### 5.更新麦克风属性
```JavaScript
    function updateVoiceInfo(uint256 tokenId, Voice calldata voice) external onlyRole(OPERATOR_ROLE);
    说明: 需要运营管理员OPERATOR_ROLE权限

    入参:
        tokenId: 需要更新的tokenId
        voice: {
            uint128 life; //寿命
            uint128 grade; //等级
            uint256 parent; //父
            uint256 mother; //母
            string tokenURI; //元数据uri
        }
```

#### 6.销毁
```JavaScript
    function burn(uint256 tokenId) public;

    入参: 
        tokenId: 需要销毁的tokenId
```

#### 7.质押
```JavaScript
    function deposit(uint256 tokenId, uint256 userId) external nonReentrant;
    
    入参:
        tokenId: 质押的tokenId
        userId: 数据库userId
```

#### 8.提取已质押的
```JavaScript
    function withdraw(address to, uint256 tokenId, uint128 life, uint128 grade) external onlyRole(OPERATOR_ROLE);
    说明: 需要运营管理员OPERATOR_ROLE权限
    
    入参:
        to: 接收地址
        tokenId: tokenId
        life: 寿命
        grade: 等级
```

#### 9.合成
```JavaScript
    function synthesis(uint256 parent, uint256 mother, address to, string calldata _tokenURI) external onlyRole(OPERATOR_ROLE);
    说明: 需要运营管理员OPERATOR_ROLE权限
    
    入参:
        parent: 父的tokenId
        mother: 母的tokenId
        to: 新的token的接收地址
        _tokenURI: 元数据uri
```


## 查询接口

#### 1.查询地址所有麦克风nft
```JavaScript
    function tokensOfOwner(address _owner) external view returns (uint256[] memory);
    
    入参:
        _owner: 查询地址
    返回:
        1. uint256[]: 拥有的tokenId, 数组
```

#### 2.查询元数据
```JavaScript
    function metaMutData(uint256 _tokenId) public view returns(uint128 life, uint128 grade, bool status, string memory uri);

    入参: 
        _tokenId: 需要查询的tokenId
    返回:
        1. life: token的寿命
        2. grade: 等级
        3. status: 状态, true = 可用, false = 不可用
```

#### 3.查询麦克风nft属性
```JavaScript
    function getVoiceInfo(uint256 tokenId) external view returns (Voice memory);

    入参:
        tokenId: 需要查询的tokenId
    返回:
        1. Voice: {
            uint128 life; //寿命
            uint128 grade; //等级
            uint256 parent; //父
            uint256 mother; //母
            string tokenURI; //元数据uri
        }
```

#### 4.查询是否质押
```JavaScript
    function isStaking(uint256 tokenId) public view returns (bool);

    入参: 
        tokenId: 需要查询的地址
    返回:
        1. bool: 是否已质押
```

